<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üì° Teacher Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    /* Global Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg,#f4f6f9,#e0e7ff);
      margin: 0;
      padding: 0;
      text-align: center;
      min-height: 100vh;
    }

    header {
      background: #4CAF50;
      color: white;
      padding: 25px 10px;
      font-size: 28px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      letter-spacing: 1px;
    }

    section {
      margin: 30px auto;
      padding: 30px 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      max-width: 450px;
      transition: transform 0.3s;
    }

    section:hover {
      transform: translateY(-3px);
    }

    h2 {
      margin-bottom: 15px;
      color: #333;
    }

    select {
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      outline: none;
      margin-bottom: 20px;
    }

    select:focus {
      border-color: #4CAF50;
      box-shadow: 0 0 5px #4CAF50;
    }

    #qrContainer {
      display: none;
      margin-top: 20px;
    }

    canvas {
      margin-top: 10px;
      border: 4px solid #4CAF50;
      border-radius: 12px;
    }

    .info {
      margin-top: 15px;
      font-size: 16px;
      color: #555;
      word-wrap: break-word;
    }

    button {
      margin-top: 15px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }

    button:hover {
      background: #45a049;
    }

    .history {
      margin-top: 20px;
      text-align: left;
      font-size: 14px;
      color: #333;
      max-height: 150px;
      overflow-y: auto;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 10px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .history-item {
      margin-bottom: 6px;
      padding: 6px 10px;
      border-radius: 6px;
      background: #e0f2e9;
      transition: background 0.3s;
    }

    .history-item:hover {
      background: #c8e6d9;
    }

  </style>
</head>
<body>
  <header>üì° Teacher Dashboard</header>

  <section>
    <h2>Generate QR for Class</h2>
    <label>Select Class:
      <select id="classSelect">
        <option value="">-- Select a Class --</option>
        <option value="CS101">CS101</option>
        <option value="CS102">CS102</option>
        <option value="CS103">CS103</option>
      </select>
    </label>

    <div id="qrContainer">
      <canvas id="qrCanvas"></canvas>
      <p class="info" id="qrInfo">QR details will appear here</p>
      <button id="copyBtn">üìã Copy QR Data</button>
      <div class="history" id="qrHistory">
        <strong>Last QR Tokens:</strong>
      </div>
    </div>
  </section>

  <script>
    let intervalId = null;
    const historyLimit = 5;
    const qrHistoryArr = [];

    function generateQR(classId) {
      const ts = Date.now();
      const token = Math.random().toString(36).substr(2, 8);
      const payload = { classId, ts, token };

      QRCode.toCanvas(document.getElementById('qrCanvas'), JSON.stringify(payload), { width: 250 });
      document.getElementById('qrInfo').innerText = `Class: ${classId}\nToken: ${token}\nLast Updated: ${new Date(ts).toLocaleTimeString()}`;

      // Add to history
      qrHistoryArr.unshift(`Token: ${token} | ${new Date(ts).toLocaleTimeString()}`);
      if (qrHistoryArr.length > historyLimit) qrHistoryArr.pop();
      updateHistory();
    }

    function updateHistory() {
      const historyDiv = document.getElementById('qrHistory');
      historyDiv.innerHTML = "<strong>Last QR Tokens:</strong>";
      qrHistoryArr.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.textContent = item;
        historyDiv.appendChild(div);
      });
    }

    document.getElementById('classSelect').addEventListener('change', function() {
      const classId = this.value;

      if (!classId) {
        document.getElementById('qrContainer').style.display = 'none';
        clearInterval(intervalId);
        return;
      }

      document.getElementById('qrContainer').style.display = 'block';
      generateQR(classId);

      clearInterval(intervalId);
      intervalId = setInterval(() => generateQR(classId), 15000); // auto-refresh every 15s
    });

    document.getElementById('copyBtn').addEventListener('click', () => {
      const text = document.getElementById('qrInfo').innerText;
      navigator.clipboard.writeText(text)
        .then(() => alert('‚úÖ QR data copied to clipboard!'))
        .catch(() => alert('‚ùå Failed to copy QR data'));
    });

  </script>
</body>
</html>
