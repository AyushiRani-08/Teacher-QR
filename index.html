<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>📡 Teacher Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  body { font-family: 'Segoe UI', sans-serif; margin:0; display:flex; min-height:100vh; background:#f0f4f8; }
  
  /* Sidebar */
  .sidebar { width:220px; background:linear-gradient(180deg,#1976d2,#42a5f5); color:white; padding-top:30px; display:flex; flex-direction:column; }
  .sidebar h2 { text-align:center; margin-bottom:40px; font-size:22px; }
  .sidebar a { padding:15px 25px; color:white; text-decoration:none; font-weight:bold; margin-bottom:5px; border-radius:8px; transition: background 0.3s; }
  .sidebar a:hover { background: rgba(255,255,255,0.2); }

  /* Main Content */
  .main { flex:1; padding:30px; overflow-y:auto; }
  header { font-size:28px; font-weight:bold; margin-bottom:30px; color:#1976d2; }

  .container { display:flex; flex-wrap:wrap; gap:25px; }

  /* Class Card */
  .class-card { background:white; border-radius:20px; box-shadow:0 12px 24px rgba(0,0,0,0.1); width:280px; padding:20px; position:relative; transition: transform 0.3s, box-shadow 0.3s; }
  .class-card:hover { transform:translateY(-6px); box-shadow:0 20px 40px rgba(0,0,0,0.15); }
  .class-card::before { content:''; position:absolute; width:150%; height:150%; top:-75%; left:-75%; background:linear-gradient(45deg,#42a5f5,#1976d2,#66bb6a); opacity:0.1; transform:rotate(45deg); }

  h3 { margin-bottom:10px; color:#212121; position:relative; z-index:1; }
  p { font-size:14px; color:#555; margin:5px 0; position:relative; z-index:1; }

  .generateBtn { margin-top:12px; padding:10px 20px; border-radius:12px; border:none; background:linear-gradient(to right,#42a5f5,#1976d2); color:white; font-weight:bold; cursor:pointer; transition: transform 0.2s, background 0.3s; position:relative; z-index:1; }
  .generateBtn:hover { transform:scale(1.05); background:linear-gradient(to right,#1976d2,#42a5f5); }

  .qr-container { display:none; text-align:center; margin-top:12px; position:relative; z-index:1; }
  canvas { border:3px solid #1976d2; border-radius:12px; margin-top:8px; }
  .info { margin-top:8px; font-size:13px; color:#333; word-break: break-word; }
</style>
</head>
<body>

<div class="sidebar">
  <h2>Teacher Panel</h2>
  <a href="#" onclick="showSection('home')">🏠 Home</a>
  <a href="#" onclick="showSection('analytics')">📊 Analytics</a>
  <a href="#" onclick="showSection('attendance')">📡 Attendance</a>
  <a href="#" onclick="logout()">🚪 Logout</a>
</div>

<div class="main">
  <header>📚 Dashboard</header>

  <!-- Sections -->
  <div id="home" class="section">
    <h2>Classes Overview</h2>
    <div class="container" id="classesContainer"></div>
  </div>

  <div id="analytics" class="section" style="display:none;">
    <h2>📊 Analytics</h2>
    <p>Charts and trends will appear here.</p>
  </div>

  <div id="attendance" class="section" style="display:none;">
    <h2>📡 Attendance QR Generator</h2>
    <div class="container" id="attendanceContainer"></div>
  </div>
</div>

<script>
  const classes = [
    { code: "CS101", subject: "Programming Basics", room: "B101", students: 25 },
    { code: "CS102", subject: "Data Structures", room: "B102", students: 22 },
    { code: "CS103", subject: "Databases", room: "B103", students: 20 },
    { code: "CS104", subject: "Web Development", room: "B104", students: 28 },
  ];

  let currentQRInterval = null;
  let currentActiveCard = null;

  function createClassCards(containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    classes.forEach(cls => {
      const card = document.createElement('div');
      card.className = 'class-card';

      card.innerHTML = `
        <h3>${cls.code} - ${cls.subject}</h3>
        <p><strong>Room:</strong> ${cls.room}</p>
        <p><strong>Students:</strong> ${cls.students}</p>
        <button class="generateBtn">Generate QR</button>
        <div class="qr-container">
          <canvas></canvas>
          <p class="info"></p>
        </div>
      `;

      const btn = card.querySelector('.generateBtn');
      const qrContainer = card.querySelector('.qr-container');
      const canvas = card.querySelector('canvas');
      const info = card.querySelector('.info');

      btn.addEventListener('click', () => {
        // Hide previous active QR
        if (currentActiveCard && currentActiveCard !== card) {
          clearInterval(currentQRInterval);
          currentActiveCard.querySelector('.qr-container').style.display = 'none';
        }

        currentActiveCard = card;
        qrContainer.style.display = 'block';

        // Start generating QR every 15 sec
        function generateQR() {
          const ts = Date.now();
          const token = Math.random().toString(36).substr(2,8);
          const payload = { classId: cls.code, ts, token };
          QRCode.toCanvas(canvas, JSON.stringify(payload), { width: 220 });
          info.innerText = `Class: ${cls.code}\nToken: ${token}\nGenerated: ${new Date(ts).toLocaleTimeString()}`;
        }

        // Generate immediately & clear any previous interval
        clearInterval(currentQRInterval);
        generateQR();
        currentQRInterval = setInterval(generateQR, 15000);
      });

      container.appendChild(card);
    });
  }

  createClassCards('classesContainer');
  createClassCards('attendanceContainer');

  function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(sec => sec.style.display='none');
    document.getElementById(sectionId).style.display='block';
  }

  function logout() {
    alert("🚪 Logging out...");
  }
</script>

</body>
</html>
